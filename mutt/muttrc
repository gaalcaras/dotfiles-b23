# ##############
# MUTTRC
# ##############

# MAILBOXES {{{

# Offlineimap downloads email there:
set folder=~/.email/

# Email adresses
set my_gmail_em=`pass show email/gmail.com/user`
set my_ehess_em=`pass show email/ehess.fr/user`
set my_telecom_em=`pass show email/telecom-paristech.fr/user`

# Noms et emails
set my_name="Gabriel Alcaras"
set use_from=yes
alternates $my_gmail_em|$my_ehess_em|$my_telecom_em

# unbind g before loading macros
bind index,pager g noop

# Mailboxes
folder-hook gmail* 'source ~/.mutt/gmail'
folder-hook ehess* 'source ~/.mutt/ehess'
folder-hook telecom* 'source ~/.mutt/telecom'

# unset wait_key

# Sync inbox on startup
# startup-hook "push '<shell-escape>email-fast-sync<enter>'"

# Sync folders and send queue on shutdown
# shutdown-hook "push '<shell-escape>email-long-sync<enter>'"

# Default mailbox
source ~/.mutt/gmail

# }}}

# GENERAL PARAMETERS  {{{
set realname = "Gabriel Alcaras"

unset imap_passive
set imap_keepalive = 300
set mail_check = 120
set sleep_time = 0

set mailcap_path = ~/.dotfiles/mutt/mailcap

set include=yes # Include a copy of the message when replying
set copy=yes # Copy sent mail to Sent folder
set delete=yes # Just delete it
unset confirmappend # Just append messages to folder
set quit=ask-yes
set postpone=ask-yes

# Pager
set pager="builtin"
set pager_context=5 # 5 lines of overlap when scrolling up or down
set pager_index_lines = 10 # Show index lines in pager

# Order headers
unhdr_order *
hdr_order Date: From: Subject: To: Cc

set send_charset="utf-8"

set date_format="%m/%d %H:%M"
set index_format="%2C %Z %d %-15.15F %s"

# Vim, of course
set editor=`echo \$EDITOR`

# Khard
set query_command= "khard email --parsable %s"

auto_view text/html # View html emails
alternative_order text/plain text/enriched text/html
auto_view application/pdf
# }}}

# SIDEBAR {{{
macro index,pager,attach '~' '<enter-command>toggle sidebar_visible<enter>'

unset sidebar_visible
set sidebar_format = "%B%?F? [%F]?%* %?N?%N/?%S"
set mail_check_stats
set status_chars  = " *%A"
set status_format = "\n───[ Folder: %f ]───[%r%m messages%?n? (%n new)?%?d? (%d to delete)?%?t? (%t tagged)? ]───%>─%?p?( %p postponed )?───"
set sidebar_divider_char = " | "

set sidebar_short_path = yes
set sidebar_delim_chars = '/.'
# }}}

# THREADS {{{
set sort="threads" 
set strict_threads="yes"
set sort_browser="reverse-date"
set sort_aux="reverse-last-date-received"
set uncollapse_jump # Go to next unread message when thread uncollapsed
set collapse_unread # don't collapse on an unread message
# }}}

# BINDINGS {{{
bind editor <space> noop # Accept spaces in your folder names

bind index \Cs save-message
bind index,pager s previous-entry
bind index,pager t next-entry
bind index,pager } next-thread
bind index,pager { previous-thread
bind index,pager \Cf next-page
bind index,pager \Cb previous-page
bind index G last-entry
bind index gg first-entry

bind index,pager z noop
bind index zC collapse-all
bind index zc collapse-thread

bind index,pager \CP sidebar-prev
bind index,pager \CN sidebar-next
bind index,pager \CO sidebar-open

bind index,pager R group-reply

# Khard
bind editor <Tab> complete-query
bind editor ^T    complete
# }}}

# COLORS {{{

source ~/.mutt/colors # Nice colorscheme

# }}}

# MACROS {{{
# View email in $BROWSER
macro attach 'V' "<pipe-entry>cat >~/.cache/mutt/mail.html && $BROWSER ~/.cache/mutt/mail.html && rm ~/.cache/mutt/mail.html<enter>"

# Display links in email
macro pager \cl <pipe-entry>'urlscan'<enter> 'Follow links with urlscan'

# Save attachment
macro attach S <save-entry><bol>/home/gabo/Downloads/mutt/<eol><enter>

# Switch between mailboxes
macro index,pager <F1> '<enter-command>source ~/.mutt/gmail<enter><change-folder>!<enter>'
macro index,pager <F2> '<enter-command>source ~/.mutt/ehess<enter><change-folder>!<enter>'
macro index,pager <F3> '<enter-command>source ~/.mutt/telecom<enter><change-folder>!<enter>'

macro index,pager A "<pipe-message>khard add-email<return>" "add the sender email address to khard"
# }}}
