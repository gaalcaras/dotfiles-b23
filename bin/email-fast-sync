#!/bin/bash

# ==========================================
# Fast email sync
#
# Retrieve inboxes only, when connected to
# the Internet.
# ==========================================

# Syncing email command with offlineimap:
#   -f just sync inbox folders to keep it fast
#   -o run only once
#   -u choose interface to be quiet except in case of errors
#   -l log it to file
sync_email="offlineimap -f inbox -o -u quiet -l $HOME/.offlineimap-cron.log"

# Exit if we're offline
check-connection

connection_status=$?
if [ $connection_status -ne 0 ]; then
  exit 1
fi

# Check if offlineimap is running:
pid=$(pgrep -f offlineimap)
if [[ ${pid} -gt 0 ]] ; then
    echo "Offlineimap is running with pid ${pid}"
    exit 1
fi

# If offlineimap is not running, then:
exec ${sync_email}
