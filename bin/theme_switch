#!/bin/bash

# ################################################
# Switch WM theme between solarized light and dark
# by @gaalcaras
# ################################################

THEME="$HOME/.theme_dark"
B16_THEME="$HOME/.base16_current"

TERMITE="$HOME/.dotfiles/termite"
I3="$HOME/.dotfiles/i3"
I3CONFIG="$HOME/.config/i3/config"

BASE16="/home/gaalcaras/.base16-manager"
BASE16_X="$BASE16/chriskempson/base16-xresources/xresources"
BASE16_TERMITE="$BASE16/theova/base16-qutebrowser/themes/default"

apply_theme() {
  theme="$1"
  b16_theme=$(cat "$B16_THEME")

  mkdir -p "$HOME/.Xresources.d"
  base16-manager set "$b16_theme"

  killall -USR1 termite

  # i3
  cat "$I3/config_local" "$I3/$theme" > "$I3CONFIG"
  i3-msg -q reload
  i3-msg -q restart

  qutebrowser :config-source

  # Nvim
  nvim_do.py  -c "colorscheme base16-$b16_theme"
}

if [ -f "$THEME" ];
then
  theme="$(cat $THEME)"
else
  theme="dark"
fi

# Apply new theme according to current one
if [[ "$theme" == "light" ]]
then
  echo "tomorrow-night" > "$B16_THEME"
  echo "dark" > "$THEME"
  apply_theme "dark"
else
  echo "tomorrow" > "$B16_THEME"
  echo "light" > "$THEME"
  apply_theme "light"
fi
