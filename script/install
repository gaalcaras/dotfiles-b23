#!/usr/bin/env bash
#
# Install all dependencies

# ############################
# Color management and setup
# ############################

red=`tput setaf 1`
blue=`tput setaf 4`
mage=`tput setaf 5`
green=`tput setaf 1`
reset=`tput sgr0`

# Output messages in magenta
function msg {
  echo "${mage}$1${reset}"
}

function doing {
  echo "${blue}> $1...${reset}"
}

function warning {
  echo "${red}$1.${reset}"
}

set -e

cd "$(dirname $0)"/..

usr=$(env | grep SUDO_USER | cut -d= -f 2)
home=$( getent passwd "$usr" | cut -d: -f6 )
run_as_normal="sudo -u $usr"

# ############################
# Script
# ############################

if [ "$EUID" -ne 0 ]; then
  warning "Please, run this script with sudo ;-)"
  exit
fi

doing 'Checking your Linux flavor'

response=`uname -a`
if [[ $response == *"ARCH"* ]]; then
  system='arch'
  msg "You're runningÂ ArchLinux. KISS!"
elif [[ $response == *"Ubuntu"* ]]; then
  system='ubuntu'
  msg "Your're running Ubuntu, mate."
else
  system=''
  msg "Unknown Linux flavor here!"
fi

echo

# Add spell check dictionaries
if [ ! -f $home/.vim/spell/fr.utf-8.spl ]; then
  doing 'Installing Spell Checking files'
  $run_as_normal cp -R $home/.dotfiles/vim/spell $home/.vim/spell
fi

# Install vim-plug if necessary
if [ ! -f $home/.vim/autoload/plug.vim ]; then
  doing 'Installing Vim-Plug'
  $run_as_normal curl -fLo $home/.vim/autoload/plug.vim --create-dirs \
      https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
fi

msg "Do you want to install and update your vim plugins?"
select yn in "Yes" "No"; do
  case $yn in
    Yes ) doing 'Installing and updating vim plugins';
      vim +PlugUpdate +qall
      break;;
    No ) exit;;
  esac
done

msg "Install script over \o/"
